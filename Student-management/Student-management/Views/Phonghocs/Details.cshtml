@model Student_management.Models.Phonghoc

@{
    ViewData["Title"] = "Chi tiết Phòng học";
}

<h1 class="mb-4">@ViewData["Title"]: @Model.TenPhong</h1>

<div class="card shadow-sm mb-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Thông tin chung</h5>
    </div>
    <div class="card-body">
        <dl class="row">
            <dt class="col-sm-3">Tên Phòng</dt>
            <dd class="col-sm-9">@Model.TenPhong</dd>

            <dt class="col-sm-3">Sức Chứa</dt>
            <dd class="col-sm-9">@Model.SucChua người</dd>

            <dt class="col-sm-3">Vị Trí</dt>
            <dd class="col-sm-9">@Model.ViTri</dd>
        </dl>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Lịch sử dụng (Học kỳ hiện tại)</h5>
    </div>
    <div class="card-body table-responsive">
        @{
            var currentSemesterSchedules = Model.Lichhocs.Where(l => l.MaHkNavigation != null && l.MaHkNavigation.NgayBatDau <= DateTime.Now && l.MaHkNavigation.NgayKetThuc >= DateTime.Now);
            var daysOfWeek = new List<string> { "Thứ Hai", "Thứ Ba", "Thứ Tư", "Thứ Năm", "Thứ Sáu", "Thứ Bảy" };
            var tietHocMax = currentSemesterSchedules.Any() ? currentSemesterSchedules.Max(l => l.TietHoc) ?? 5 : 5;
            var scheduleLookup = currentSemesterSchedules.ToLookup(l => l.ThuTrongTuan);
        }
        <table class="table table-bordered text-center small">
            <thead class="table-light">
                <tr>
                    <th>Tiết</th>
                    @foreach (var day in daysOfWeek)
                    {
                        <th>@day</th>
                    }
                </tr>
            </thead>
            <tbody>
                @for (int t = 1; t <= tietHocMax; t++)
                {
                    <tr>
                        <td class="fw-bold">@t</td>
                        @foreach (var day in daysOfWeek)
                        {
                            <td>
                                @{
                                    var lich = scheduleLookup[day].FirstOrDefault(l => l.TietHoc == t);
                                }
                                @if (lich != null)
                                {
                                    <div><strong>Lớp @lich.MaLopNavigation?.TenLop</strong></div>
                                    <div class="text-muted">@lich.MaMonHocNavigation?.TenMonHoc</div>
                                    <div class="text-muted fst-italic">@lich.MaGvNavigation?.HoTen</div>
                                }
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="mt-4">
    <a asp-action="Edit" asp-route-id="@Model.MaPhong" class="btn btn-warning"><i class="fas fa-edit me-2"></i>Chỉnh sửa</a>
    <a asp-action="Index" class="btn btn-secondary">Quay lại Danh sách</a>
</div>